# 4장. 데이터의 추가, 삭제, 갱신

## 17강 - 행 삭제하기, DELETE

DB가 저장된 저장장치의 저장용량은 무제한으로 저장할 수 없는만큼 저장공간이 모자라다면 데이터를 삭제해야 하는 경우도 자주 발생한다. 이때 사용하는 `DELETE` 명령에 관해 정리하자.

### 1. DELETE로 행 삭제하기

RDBMS에서 데이터를 삭제할 경우 행 단위로 `DELETE` 명령을 수행한다.

`DELETE FROM 테이블명 WHERE 조건식`

`DELETE`을 수행하기 전 `SELECT` 명령으로 테이블을 확인해보자.

>
`SELECT * FROM sample41;`
![](https://images.velog.io/images/gshduet/post/e92bf756-deab-4ef3-bf82-3a523691b45d/image.png)
`DELETE FROM sample41 WHERE no = 3;`
![](https://images.velog.io/images/gshduet/post/5cf90df9-0ee7-4bb8-8d2e-37be47b7e013/image.png)

여기에 `DELETE FROM sample41;` 명령을 실행하면 `sample41` 테이블의 모든 데이터가 삭제된다. `WHERE` 구를 생략할 경우 모든 행을 대상으로 작동하기 때문이다. `WHERE` 구를 지정할 경우 조건에 맞는 행만 삭제 대상이 된다. 단 `SELECT` 명령 같이 열을 지정할 순 없다.

## 18강 - 데이터 갱신하기, UPDATE

데이터 갱신 작업은 시스템을 다루는 과정에서 자주 발생한다. 이런 경우 사용할 `UPDATE` 명령에 대해 정리하자.

### 1. UPDATE로 데이터 갱신하기

RDBMS에선 `UPDATE` 명령으로 데이터를 갱신할 수 있다. `UPDATE` 명령은 테이블의 셀 값을 갱신한다.

`UPDATE 테이블명 SET 열명 = 값 WHERE 조건식`

`UPDATE` 는 셀 단위로 데이터를 갱신할 수 있고 `WHERE` 구에 조건을 지정하면 그에 일치하는 행을 갱신할 수 있다. `UPDATE` 명령에 `SET` 구를 사용해 갱신할 열과 값을 지정한다. `WHERE` 구를 생략할 경우 `DELETE` 와 마찬가지로 테이블의 모든 행이 갱신된다. 이 경우 의도치 않은 데이터 갱신이 발생할 수 있음으로 주의해야 한다.

또한 

* 테이블에 존재하지 않는 열을 지정하면 당연하게도 에러가 발생한다. 값은 상수로 표기해야한다. 
* `INSERT` 명령과 마찬가지로 자료형에 맞는 값을 지정해야 한다. 
* 갱신해야 할 열과 값이 복수인 경우 콤마(,)로 구분해 리스트 형식으로 지정할 수 있다.

>
`SELECT * FROM sample41;`
![](https://images.velog.io/images/gshduet/post/cf5973fd-47de-4205-863f-27e8018437d9/image.png)
`UPDATE sample41 SET b = '2014-09-07' WHERE no = 2;`
![](https://images.velog.io/images/gshduet/post/80780dc1-e200-4977-a8fd-a7919dd5366e/image.png)


### 2. UPDATE로 갱신할 경우 주의사항

`SET` 구의 `=` 은 비교 연산자가 아닌 대입 연산자로 연산 방법이 조금 다르다. 일단 테이블을 생성하면 `INSERT` 명령을 이용해 행을 추가하기 전까지 아무 데이터가 존재하지 않는다. `UPDATE` 명령은 이미 존재하는 행에 대해 값을 갱신하므로 갱신 이전의 값과 이후의 값 두 가지 상태로 나눌 수 있다.

여기에 다음과 같은 `UPDATE` 명령을 실행하면 어떻게 될지 생각해보자.

`UPDATE sample41 SET no = no + 1;`

이 명령문에는 `WHERE` 구가 지정되어 있지 않음으로 테이블의 모든 행이 대상이 될 것이다 `SET` 구에서 `no` 열의 값을 갱신하는데 그 갱신 값은 본래 값에서 1을 더한 값이다.

>
`SELECT * FROM sample41;`
![](https://images.velog.io/images/gshduet/post/0d572041-e99b-49db-a25c-dbd370c762b7/image.png)
`UPDATE sample41 SET no = no + 1;`
![](https://images.velog.io/images/gshduet/post/b71520be-935e-40eb-8a23-5ad1dfdc37b8/image.png)

### 3. 복수열 갱신

`UPDATE` 명령의 `SET` 구에선 필요에 따라 콤마(,)로 구분해 갱신할 열을 여러 개 지정할 수 있다. 여러 구문으로 나누어 갱신하는 것보다 하나로 묶어 실행하는 편이 더 효율적이다.

`UPDATE 테이블명 SET 열명1 = 값1, 열명2 = 값2, ∙∙∙ WHERE 조건식`

### 4. NULL로 갱신하기

`UPDATE` 명령으로 셀 값을 NULL 로 갱신할 수 있다. 이를 **NULL 초기화**라 부르기도 한다. 다만 NOT NULL 제약이 설정된 열에 NULL이 허용되지는 않는다.

## 19강 - 물리삭제와 논리삭제

DB에서 데이터를 삭제하는 방법은 용도에 따라 크게 **물리삭제**와 **논리 삭제** 두 가지로 나뉜다. 이는 전용 SQL 명령문이 있는 것이 아닌 시스템 설계 분야에 관한 것으로 데이터를 삭제하는데 두 가지 사고 방식이 있다고 이해하면 쉽다.

### 1. 두 종류의 삭제방법

먼저 물리삭제는 SQL의 `DELETE` 명령을 사용해 데이터를 직접 삭제(Hard Delete)하는 것이다. 삭제 대상 데이터를 더 이상 필요 없는 데이터로 판단해 테이블에서 삭제해버리는 지극히 자연스러운 발상에 의한 삭제 방법이다.

논리삭제의 경우 테이블에 '삭제플래그(예시)' 같은 열을 미리 준비해두고 테이블에서 실제 행을 삭제하는 대신 `UPDATE` 명령을 통해 '삭제플래그'의 값을 유효하게 갱신(Soft Delete)하자는 발상에 의한 삭제방법이다. 실제 데이터는 테이블에 남아 있지만 참조할 때 '삭제플래그'가 삭제로 설정된 행을 제외하는 조건을 달아 `SELECT` 명령을 실행한다. 결과적으로는 해당 행이 삭제된 것처럼 보인다.

논리삭제는 데이터를 삭제하지 않기 때문에 복원하기 쉽다는 장점이 있으나 삭제해도 DB의 저장공간이 늘어나지 않는 점, DB의 크기가 증가함에 따라 검색속도가 떨어지는 점 등의 단점이 있다.

### 2. 삭제방법 선택하기

삭제방법을 결정하는 것에는 시스템의 특성이나 데이터의 특성에 따라 다르기 때문에 단정지어 말할 수 없다.

예를 들어 SNS 서비스처럼 사용자의 개인정보를 다루는 시스템에서 사용자가 탈퇴할 경우 바로 물리삭제를 진행한다. 개인정보 유출을 미연에 방지하는 측면에서 좋은 선택이기 때문이다.

이와 반대로 쇼핑몰의 경우 사용자가 주문 취소를 했을 경우에 논리삭제를 진행한다. 주문을 취소 했더라도 발주는 된 것으로 해당 데이터를 주문 관련 통계를 낼 때 유용하게 사용할 수 있기 때문이다.

한편 하드웨어의 제한으로 물리삭제를 할 수 밖에 없는 경우도 있다. 논리삭제로는 DB의 저장공간을 확보할 수 없기 때문에 저장공간이 작다면 용량이 모자라지 않도록 운용할 필요성이 있으며 결국 물리삭제를 통해 데이터를 지울 수 밖에 없다.