# 3장. 정렬과 연산
## 13강 - 문자열 연산

　문자열끼리 연산하는 연산자는 많지 않다. 문자열을 가공하는 함수 중 가장 자주 사용되는 것들을 정리한다.

### 1. 문자열 결합

　문자열 결합이란 문자열 데이터를 결합하는 연산으로 2개의 열 데이터를 모아 1개의 열로 처리하고 싶은 경우 자주 사용한다.

> ex) 'ABC' || '1234' --> 'ABC1234'

　문자열을 결합하는 연산자는 DB 제품 별로 방언이 있다.

<table border="1">
  <tr>
    <th width = 50%>DB 제품</th>
    <th>연산자 ∙ 함수</th>
  </tr>
  <tr>
    <td>SQL Server</td>
    <td>+</td>
  </tr>
  <tr>
    <td>Oracle, PostgreSQL, DB2</td>
    <td>||</td>
  </tr>
  <tr>
    <td>MySQL</td>
    <td>CONCAT</td>
  </tr>
</table>

>
`SELECT * FROM sample35;`
![](https://images.velog.io/images/gshduet/post/fa6d93b7-af5c-44be-8a59-ac830354a12c/image.png)

　sample35 테이블의 unit열은 문자열형이고 quantity 열은 INTEGER 형의 열이다. 이 둘을 CONCAT 함수를 통해 결합해보자.

> 
`SELECT CONCAT(quantity, unit) FROM sample35;`
![](https://images.velog.io/images/gshduet/post/fb27b692-dba1-4138-8e44-80188fb42776/image.png)

문자열 결합이지만 수치 데이터와도 문제 없이 연산할 수 있다. 단, 문자열로 결합한 결과는 문자열형이 된다.

### 2. SUBSTRING 함수

　**SUBSTRING 함수**는 문자열의 일부분을 계산해 반환해주는 함수이다. 날짜를 YYYYMMDD의 형식의 문자열 데이터로 저장하는 경우 년, 월, 일을 각각 따로 추출해내고 싶은 경우가 생길 수 있다. 이럴 때 SUBSTRING 함수를 통해 추출해 낼 수 있다.

>ex)
SUBSTRING('추출대상', 추출시작 위치, 추출할 문자열 갯수)
SUBSTRING('20220217', 1, 4) --> '2022'
SUBSTRING('20220217', 5, 2) --> '02'

### 3. TRIM 함수

　**TRIM 함수**는 문자열 앞뒤로 여백이 있을 경우 이를 제거해주는 함수이며 문자열 중간의 여백은 제거되지 않는다.

　CHAR형 문자열 데이터의 경우 [앞에서](https://velog.io/@gshduet/firststep-of-sql-02) 설명했던 것처럼 고정 길이 문자열이므로 언제나 처음 지정된 길이로 고정되어 데이터가 저장되며 최대 길이보다 짧은 문자열을 저장할 경우 남은 공간은 여백으로 채워 저정한다. 이때 저장된 공백을 제거할 때 TRIM 함수를 사용할 수도 있다.

　또한 인수를 지정하는 것으로 공백 이외의 문자를 제거할 수도 있다.

>
ex) TRIM('ABC　　　') --> 'ABC'

### 4. CHARACTER_LENGTH 함수, OCTET_LENGTH 함수

　**CHARACTER_LENGTH 함수**는 문자열의 길이를 계산해 반환하는 함수이다. VARCHAR형 문자열 데이터는 가변 길이이므로 길이가 서로 다르다. 이런 데이터에 CHARACTER_LENGTH 함수를 사용하면 문자열의 길이를 계산할 수 있다. 문자열의 길이는 문자 단위로 계산되어 수치로 반환된다.

　컴퓨터에 저장되는 이미지, 음성, 문자, 숫자 등의 다양한 데이터는 결국 수치(바이트 단위)로 저장된다. 문자든 이미지든 하나의 데이터가 몇 바이트를 필요로 하는지는 인코드 방식에 따라 결정된다. 

　인코딩 방식에 따라 필요로 하는 저장공간의 크기가 달라지는 것이며 문자열이 차지하고 있는 저장공간을 나타내는 함수로 **OCTET_LENGTH 함수**가 있다.
 
 #### - 문자세트(character set)
 
　한중일의 인쇄 문화에서 반각과 전각이라는 용어를 사용해 문자를 구분한다. 알파벳은 반각, 한글의 전각문자라고 할 수 있다. 반각은 전각에 비해 화면에서 차지하는 공간이 절반이며 저장용량 역시 반각이 더 작다. 
 
　반각의 알파벳, 숫자, 기호는 ASCII 문자라고도 불린다. 전각문자인 한글의 경우 'EUC-KR', 'UTF-8' 인코딩 방식을 자주 사용한다. 핵심은 한 문자가 몇 바이트인지는 사용되는 문자세트에 따라 다르다는 것이다.
 
　CHAR_LENGTH 함수를 사용할 경우 반각이든 전각이든 문자열의 문자 수에 따라 계산되기 때문에 문제될 것이 없지만 OCTET_LENGTH의 경우 문자의 수가 아닌 바이트 단위로 길이를 계산하므로 값이 달라질 수 있다.
 
　'**A는 반각, 한은 전각**'이라는 문자열은 문자 수는 12개로 동일하지만 바이트 수는 EUC-KR에서는 19바이트, UTF-8에서는 26바이트를 차지한다. EUC-KR든 UTF-8이든 ASCII 문자는 1바이트를 차지하지만 한글의 경우 전자는 2바이트, 후자는 3바이트를 차지하기 때문에 차이가 나는 것이다.